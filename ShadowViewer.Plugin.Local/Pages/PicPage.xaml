<Page
    x:Class="ShadowViewer.Plugin.Local.Pages.PicPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:ShadowViewer.Plugin.Local.Controls"
    xmlns:controls1="using:ShadowViewer.Controls"
    xmlns:controls2="using:CommunityToolkit.WinUI.Controls"
    xmlns:converters="using:ShadowViewer.Plugin.Local.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:enums="using:ShadowViewer.Plugin.Local.Enums"
    xmlns:i18N="using:ShadowViewer.Plugin.Local.I18n"
    xmlns:interfaces="using:ShadowViewer.Plugin.Local.Models.Interfaces"
    xmlns:local="using:ShadowViewer.Plugin.Local"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:winUi="using:FluentIcons.WinUI"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:LocalReaderModeConverter x:Key="LocalReaderModeConverter" />
    </Page.Resources>
    <Grid
        x:Name="RootGrid"
        Background="{ThemeResource LayerFillColorDefaultBrush}"
        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
        BorderThickness="1"
        CornerRadius="{ThemeResource NavigationViewContentGridCornerRadius}"
        PointerWheelChanged="MangaPointerWheelChanged"
        Tapped="PageTapped">
        <controls:LocalReader
            x:Name="MangaReader"
            HorizontalAlignment="Stretch"
            CurrentEpisodeIndex="{x:Bind ViewModel.CurrentEpisodeIndex, Mode=TwoWay}"
            CurrentIndex="{x:Bind ViewModel.CurrentPage, Mode=TwoWay}"
            IgnoreViewChanged="{x:Bind ViewModel.IsMenu, Mode=OneWay}"
            Pictures="{x:Bind ViewModel.Images, Mode=OneWay}"
            ReaderMode="{x:Bind LocalPluginConfig.LocalReaderMode, Mode=TwoWay}"
            SmoothScroll="{x:Bind LocalPluginConfig.PageAutoTurn, Mode=TwoWay}" />
        <controls:FlashIcon
            Margin="0,0,0,0"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Status="{x:Bind LocalPluginConfig.PageAutoTurn, Mode=OneWay}"
            ToolTipService.ToolTip="{i18N:Locale Key=AutoPage}"
            Visibility="{x:Bind LocalPluginConfig.PageAutoTurn, Mode=OneWay}" />

        <TeachingTip
            Title="{i18N:Locale Key=NextEpisodeTipTitle}"
            ActionButtonCommand="{x:Bind ViewModel.NextEpisodeCommand}"
            ActionButtonContent="{i18N:Locale Key=NextEpisode}"
            CloseButtonContent="{i18N:Locale Key=Cancel}"
            IsLightDismissEnabled="True"
            IsOpen="{x:Bind ViewModel.NextEpisodeTip, Mode=OneWay}"
            PreferredPlacement="Auto"
            Subtitle="{i18N:Locale Key=NextEpisodeTipSubTitle}" />
        <Grid
            Background="#AA141414"
            CornerRadius="6,0,6,0"
            Visibility="{x:Bind ViewModel.IsMenu, Mode=OneWay}">
            <Grid
                x:Name="TappedGrid"
                Loaded="InitTappedGridLayout"
                Visibility="{x:Bind ViewModel.TappedGridSetting, Mode=OneWay}">
                <Grid.Resources>
                    <x:Double x:Key="TextFontSize">24</x:Double>
                    <SolidColorBrush x:Key="TextForeground">White</SolidColorBrush>
                </Grid.Resources>
                <!--  5 行布局：上、中间分隔条、中、下分隔条、下  -->
                <Grid.RowDefinitions>
                    <RowDefinition Height="2*" />
                    <!--  上  -->
                    <RowDefinition Height="Auto" />
                    <!--  上下分隔条  -->
                    <RowDefinition Height="4*" />
                    <!--  中  -->
                    <RowDefinition Height="Auto" />
                    <!--  上下分隔条  -->
                    <RowDefinition Height="2*" />
                    <!--  下  -->
                </Grid.RowDefinitions>

                <!--  5 列布局：左、分隔条、中、分隔条、右  -->
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <!--  左  -->
                    <ColumnDefinition Width="Auto" />
                    <!--  左右分隔条  -->
                    <ColumnDefinition Width="3*" />
                    <!--  中  -->
                    <ColumnDefinition Width="Auto" />
                    <!--  左右分隔条  -->
                    <ColumnDefinition Width="2*" />
                    <!--  右  -->
                </Grid.ColumnDefinitions>

                <!--  上  -->
                <Grid Grid.Row="0" Grid.Column="2">
                    <Rectangle Fill="Transparent" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="{StaticResource TextFontSize}"
                        FontWeight="Bold"
                        Foreground="{StaticResource TextForeground}"
                        Text="{i18N:Locale Key=PrevPage}" />
                </Grid>
                <!--  左  -->
                <Grid Grid.Row="2" Grid.Column="0">
                    <Rectangle Fill="Transparent" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="{StaticResource TextFontSize}"
                        FontWeight="Bold"
                        Foreground="{StaticResource TextForeground}"
                        Text="{i18N:Locale Key=PrevPage}" />
                </Grid>
                <!--  下  -->
                <Grid Grid.Row="4" Grid.Column="2">
                    <Rectangle Fill="Transparent" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="{StaticResource TextFontSize}"
                        FontWeight="Bold"
                        Foreground="{StaticResource TextForeground}"
                        Text="{i18N:Locale Key=NextPage}" />
                </Grid>
                <!--  右  -->
                <Grid Grid.Row="2" Grid.Column="4">
                    <Rectangle Fill="Transparent" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="{StaticResource TextFontSize}"
                        FontWeight="Bold"
                        Foreground="{StaticResource TextForeground}"
                        Text="{i18N:Locale Key=NextPage}" />
                </Grid>

                <!--  中  -->
                <Grid Grid.Row="2" Grid.Column="2">
                    <Rectangle Fill="Transparent" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="{StaticResource TextFontSize}"
                        FontWeight="Bold"
                        Foreground="{StaticResource TextForeground}"
                        Text="{i18N:Locale Key=Menu}" />
                </Grid>

                <!--  上下分隔条（上）  -->
                <controls2:GridSplitter
                    Grid.Row="1"
                    Grid.Column="0"
                    Grid.ColumnSpan="5"
                    Height="5"
                    HorizontalAlignment="Stretch"
                    Background="Gray" />

                <!--  上下分隔条（下）  -->
                <controls2:GridSplitter
                    Grid.Row="3"
                    Grid.Column="0"
                    Grid.ColumnSpan="5"
                    Height="5"
                    HorizontalAlignment="Stretch"
                    Background="Gray" />

                <!--  左右分隔条（左）  -->
                <controls2:GridSplitter
                    Grid.Row="0"
                    Grid.RowSpan="5"
                    Grid.Column="1"
                    Width="5"
                    VerticalAlignment="Stretch"
                    Background="Gray" />

                <!--  左右分隔条（右）  -->
                <controls2:GridSplitter
                    Grid.Row="0"
                    Grid.RowSpan="5"
                    Grid.Column="3"
                    Width="5"
                    VerticalAlignment="Stretch"
                    Background="Gray" />

            </Grid>
            <!--  顶部中央悬浮的当前章节选择器  -->
            <ComboBox
                Margin="0,10,0,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                DisplayMemberPath="Title"
                ItemsSource="{x:Bind ViewModel.Episodes, Mode=OneWay}"
                SelectedIndex="{x:Bind ViewModel.CurrentEpisodeIndex, Mode=TwoWay}"
                Visibility="{x:Bind ViewModel.IsMenu, Mode=OneWay}" />

            <Grid
                Margin="0,0,0,10"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                Background="{ThemeResource AcrylicBackgroundFillColorBaseBrush}"
                CornerRadius="5"
                Opacity="{x:Bind ViewModel.MenuOpacity, Mode=OneWay}">
                <Border
                    x:Name="Menu"
                    Padding="20,5"
                    HorizontalAlignment="Center">
                    <StackPanel>
                        <Grid
                            Height="48"
                            ColumnSpacing="10"
                            Visibility="{x:Bind ReaderSettingButton.IsChecked, Mode=OneWay}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Style="{StaticResource PointerOverButtonStyle}">
                                <Grid ColumnSpacing="6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <winUi:FluentIcon
                                        Grid.Column="0"
                                        Icon="{x:Bind LocalPluginConfig.LocalReaderMode, Mode=OneWay, Converter={StaticResource LocalReaderModeConverter}}"
                                        IconVariant="{x:Bind LocalPluginConfig.LocalReaderMode, Mode=OneWay, Converter={StaticResource LocalReaderModeConverter}}" />
                                    <TextBlock Grid.Column="1" Text="{x:Bind LocalPluginConfig.LocalReaderMode, Mode=OneWay, Converter={StaticResource LocalReaderModeConverter}}" />
                                </Grid>
                                <Button.Flyout>
                                    <controls1:EnumMenuFlyout
                                        Closed="ReadModeClosed"
                                        EnumSource="enums:LocalReaderMode"
                                        Placement="Top"
                                        SelectedValue="{x:Bind LocalPluginConfig.LocalReaderMode, Mode=TwoWay}"
                                        TextConverter="{StaticResource LocalReaderModeConverter}" />
                                </Button.Flyout>
                            </Button>
                            <!--  <ToggleButton  IsEnabled="{x:Bind ViewModel.ScrollingPaddingEnabled,Mode=OneWay}"  -->
                            <!--  IsChecked="{x:Bind ViewModel.ScrollingPaddingSetting,Mode=TwoWay}"  -->
                            <!--  Style="{StaticResource PointerOverToggleButtonStyle}"  -->
                            <!--  Grid.Column="1">  -->
                            <!--     <StackPanel Spacing="4" Orientation="Horizontal"> -->
                            <!--         <winUi:FluentIcon Icon="SelectObjectSkew" /> -->
                            <!--         <TextBlock Text="{i18N:Locale Key=ReaderTappedGridSetting}"></TextBlock> -->
                            <!--     </StackPanel> -->
                            <!-- </ToggleButton> -->
                            <ToggleButton
                                Grid.Column="2"
                                Checked="TappedGridSet"
                                IsChecked="{x:Bind ViewModel.TappedGridSetting, Mode=TwoWay}"
                                Style="{StaticResource PointerOverToggleButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <winUi:FluentIcon Icon="SelectObjectSkew" />
                                    <TextBlock Text="{i18N:Locale Key=ReaderTappedGridSetting}" />
                                </StackPanel>
                            </ToggleButton>
                            <Button
                                Grid.Column="3"
                                Style="{StaticResource PointerOverButtonStyle}"
                                ToolTipService.ToolTip="{i18N:Locale Key=AutoPage}">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <controls:FlashIcon Status="{x:Bind LocalPluginConfig.PageAutoTurn, Mode=OneWay}" />
                                    <TextBlock Text="{i18N:Locale Key=AutoPage}" />
                                </StackPanel>
                                <Button.Flyout>
                                    <Flyout>
                                        <StackPanel
                                            Width="400"
                                            Orientation="Horizontal"
                                            Spacing="20">
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock VerticalAlignment="Center" Text="{i18N:Locale Key=AutoPageSpeed}" />
                                                <NumberBox
                                                    VerticalAlignment="Center"
                                                    LargeChange="10"
                                                    SmallChange="1"
                                                    Value="{x:Bind LocalPluginConfig.PageAutoTurnInterval, Mode=TwoWay}" />
                                            </StackPanel>
                                            <ToggleSwitch IsOn="{x:Bind LocalPluginConfig.PageAutoTurn, Mode=TwoWay}" />
                                        </StackPanel>
                                    </Flyout>
                                </Button.Flyout>
                            </Button>
                        </Grid>
                        <NavigationViewItemSeparator Visibility="{x:Bind ReaderSettingButton.IsChecked, Mode=OneWay}" />

                        <Grid Height="48" ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="30" />
                                <ColumnDefinition Width="300" />
                                <ColumnDefinition Width="30" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="48" />
                            </Grid.ColumnDefinitions>
                            <Button
                                Grid.Column="0"
                                Command="{x:Bind ViewModel.PrevEpisodeCommand}"
                                Style="{StaticResource PointerOverButtonStyle}"
                                ToolTipService.ToolTip="{i18N:Locale Key=PrevEpisode}">
                                <winUi:FluentIcon Icon="ChevronDoubleLeft" />
                            </Button>
                            <TextBlock
                                Grid.Column="1"
                                VerticalAlignment="Center"
                                Text="{x:Bind ViewModel.CurrentPage, Mode=OneWay}"
                                TextAlignment="Right" />
                            <controls:ReaderSlider
                                x:Name="PageSlider"
                                Grid.Column="2"
                                VerticalAlignment="Center"
                                Maximum="{x:Bind ViewModel.Images.Count, Mode=OneWay}"
                                Minimum="1"
                                SmallChange="1"
                                StepFrequency="1"
                                Value="{x:Bind ViewModel.CurrentPage, Mode=TwoWay}" />
                            <TextBlock
                                Grid.Column="3"
                                VerticalAlignment="Center"
                                Text="{x:Bind ViewModel.Images.Count, Mode=OneWay}" />

                            <Button
                                Grid.Column="4"
                                Command="{x:Bind ViewModel.NextEpisodeCommand}"
                                Style="{StaticResource PointerOverButtonStyle}"
                                ToolTipService.ToolTip="{i18N:Locale Key=NextEpisode}">
                                <winUi:FluentIcon Icon="ChevronDoubleRight" />
                            </Button>
                            <ToggleButton
                                x:Name="ReaderSettingButton"
                                Grid.Column="5"
                                Style="{StaticResource PointerOverToggleButtonStyle}">

                                <winUi:FluentIcon Icon="Settings" />
                            </ToggleButton>
                        </Grid>

                    </StackPanel>

                </Border>
            </Grid>


        </Grid>
    </Grid>

</Page>